# PRD DEFINITIVO - Sistema de GestÃ£o MetrolÃ³gica (SGM)
## Sistema de Gerenciamento de Equipamentos de MediÃ§Ã£o - PetrÃ³leo & GÃ¡s Natural

---

## ğŸ“‹ 1. SUMÃRIO EXECUTIVO

### 1.1 VisÃ£o Geral
O **Sistema de GestÃ£o MetrolÃ³gica (SGM)** Ã© uma aplicaÃ§Ã£o desktop especializada para controle e gestÃ£o completa de equipamentos de mediÃ§Ã£o fiscal e operacional na indÃºstria de petrÃ³leo e gÃ¡s natural. O sistema substituirÃ¡ o controle atual em planilhas Excel por uma soluÃ§Ã£o integrada, automatizada e em total conformidade com as normas ISO/IEC 17025:2017, ISO 10012:2004 e o Regulamento TÃ©cnico de MediÃ§Ã£o ANP/Inmetro nÂº 1/2013.

### 1.2 Objetivos Principais
- âœ… **Eliminar dependÃªncia de planilhas Excel** e seus riscos inerentes
- âœ… **Garantir conformidade regulamentar total** com ISO 17025, ISO 10012 e ANP/Inmetro
- âœ… **Automatizar processos crÃ­ticos** de calibraÃ§Ã£o e controle metrolÃ³gico
- âœ… **Centralizar gestÃ£o** de ~370 equipamentos ativos em 7 polos de produÃ§Ã£o
- âœ… **Prover rastreabilidade completa** para auditorias e fiscalizaÃ§Ãµes
- âœ… **Gerenciar ciclo de vida completo** dos equipamentos de mediÃ§Ã£o

### 1.3 CaracterÃ­sticas TÃ©cnicas Definitivas
- **Tipo:** AplicaÃ§Ã£o Desktop Local Mono-usuÃ¡rio
- **Banco de Dados:** SQLite (arquivo .db na pasta do aplicativo)
- **Stack:** Electron + React + Node.js + TypeScript
- **Conformidade:** ISO/IEC 17025:2017, ISO 10012:2004, ANP/Inmetro nÂº 1/2013
- **InstalaÃ§Ã£o:** Autocontida, sem dependÃªncias externas

### 1.4 Escopo Confirmado
**DENTRO DO ESCOPO:**
- GestÃ£o completa de equipamentos e certificados
- Controle de calibraÃ§Ãµes e incertezas
- GestÃ£o de poÃ§os (BTP) e anÃ¡lises quÃ­micas (FQ)
- Controle de placas de orifÃ­cio e trechos retos
- Sistema de alertas e notificaÃ§Ãµes
- RelatÃ³rios regulamentares e dashboards
- MOC (Management of Change)
- GestÃ£o de nÃ£o conformidades
- App mobile para consultas bÃ¡sicas

**FORA DO ESCOPO:**
- InteligÃªncia Artificial / Machine Learning
- IoT / Telemetria em tempo real
- GÃªmeos Digitais
- IntegraÃ§Ã£o com sensores remotos
- Multi-usuÃ¡rio ou acesso simultÃ¢neo

---

## ğŸ—ï¸ 2. ARQUITETURA DO SISTEMA

### 2.1 Arquitetura TÃ©cnica Final

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CAMADA DE APRESENTAÃ‡ÃƒO          â”‚
â”‚      Electron + React + Material-UI      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          CAMADA DE NEGÃ“CIO              â”‚
â”‚    Node.js + TypeScript + ValidaÃ§Ãµes    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         CAMADA DE DADOS                 â”‚
â”‚    SQLite (arquivo local) + Triggers    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Estrutura de DiretÃ³rios

```
sgm/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/                 # Processo principal Electron
â”‚   â”‚   â”œâ”€â”€ database/         # ConexÃ£o SQLite e models
â”‚   â”‚   â”œâ”€â”€ services/         # LÃ³gica de negÃ³cio
â”‚   â”‚   â”‚   â”œâ”€â”€ equipment/    # ServiÃ§os de equipamentos
â”‚   â”‚   â”‚   â”œâ”€â”€ calibration/  # ServiÃ§os de calibraÃ§Ã£o
â”‚   â”‚   â”‚   â”œâ”€â”€ uncertainty/  # CÃ¡lculos de incerteza
â”‚   â”‚   â”‚   â”œâ”€â”€ wells/        # GestÃ£o de poÃ§os
â”‚   â”‚   â”‚   â””â”€â”€ chemistry/    # AnÃ¡lises quÃ­micas
â”‚   â”‚   â””â”€â”€ ipc/             # Handlers IPC
â”‚   â”œâ”€â”€ renderer/            # Interface React
â”‚   â”‚   â”œâ”€â”€ components/      # Componentes UI
â”‚   â”‚   â”œâ”€â”€ pages/          # PÃ¡ginas/MÃ³dulos
â”‚   â”‚   â”œâ”€â”€ hooks/          # Custom hooks
â”‚   â”‚   â””â”€â”€ utils/          # UtilitÃ¡rios
â”‚   â””â”€â”€ shared/             # CÃ³digo compartilhado
â”‚       â”œâ”€â”€ types/          # TypeScript types
â”‚       â”œâ”€â”€ constants/      # Constantes
â”‚       â””â”€â”€ validations/    # Regras de validaÃ§Ã£o
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ sgm.db             # Arquivo SQLite principal
â”‚   â”œâ”€â”€ migrations/        # Versionamento do schema
â”‚   â”œâ”€â”€ seeds/            # Dados iniciais
â”‚   â””â”€â”€ backups/          # Backups automÃ¡ticos
â”œâ”€â”€ documents/            # Certificados e anexos
â””â”€â”€ resources/           # Assets e templates
```

### 2.3 LocalizaÃ§Ã£o do Banco de Dados

```javascript
// Caminho do banco de dados
const dbPath = {
  production: path.join(app.getPath('userData'), 'database', 'sgm.db'),
  backup: path.join(app.getPath('userData'), 'database', 'backups'),
  documents: path.join(app.getPath('userData'), 'documents')
}
// Exemplo: C:\Users\[Usuario]\AppData\Roaming\SGM\database\sgm.db
```

---

## ğŸ’¾ 3. MODELO DE DADOS COMPLETO

### 3.1 Schema do Banco de Dados - Tabelas Core

#### 3.1.1 Hierarquia Organizacional

```sql
-- Tabela: polos (7 registros)
CREATE TABLE polos (
    polo_id INTEGER PRIMARY KEY AUTOINCREMENT,
    nome_polo TEXT NOT NULL,
    sigla_polo TEXT UNIQUE NOT NULL,
    diretoria TEXT,
    empresa TEXT,
    cnpj TEXT,
    responsavel_tecnico TEXT,
    telefone TEXT,
    email TEXT,
    status TEXT DEFAULT 'ativo',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- Tabela: instalacoes
CREATE TABLE instalacoes (
    instalacao_id INTEGER PRIMARY KEY AUTOINCREMENT,
    polo_id INTEGER NOT NULL,
    nome_instalacao TEXT NOT NULL,
    sigla_instalacao TEXT UNIQUE NOT NULL,
    tipo_instalacao TEXT,
    situacao TEXT,
    ambiente TEXT CHECK(ambiente IN ('Offshore', 'Onshore')),
    lamina_agua REAL,
    estado TEXT,
    cidade TEXT,
    operadora TEXT,
    campo TEXT,
    capacidade_petroleo REAL,
    capacidade_gas REAL,
    latitude REAL,
    longitude REAL,
    responsavel_metrologia TEXT,
    status TEXT DEFAULT 'ativo',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (polo_id) REFERENCES polos(polo_id)
);
```

#### 3.1.2 GestÃ£o de Equipamentos

```sql
-- Tabela: equipamentos (expandida com novos campos)
CREATE TABLE equipamentos (
    equipamento_id INTEGER PRIMARY KEY AUTOINCREMENT,
    numero_serie TEXT UNIQUE NOT NULL,
    tag_equipamento TEXT UNIQUE NOT NULL,
    nome_equipamento TEXT NOT NULL,
    tipo_equipamento TEXT NOT NULL, -- primario, secundario, auxiliar
    subtipo_equipamento TEXT, -- coriolis, turbina, ultrasonico, etc
    modelo TEXT,
    fabricante TEXT,
    
    -- Dados tÃ©cnicos
    unidade_medida TEXT,
    resolucao REAL,
    exatidao TEXT,
    
    -- Faixas de operaÃ§Ã£o
    faixa_min_equipamento REAL,
    faixa_max_equipamento REAL,
    faixa_min_pam REAL,
    faixa_max_pam REAL,
    faixa_min_calibrada REAL,
    faixa_max_calibrada REAL,
    
    -- LocalizaÃ§Ã£o
    instalacao_id INTEGER NOT NULL,
    polo_id INTEGER NOT NULL,
    localizacao_fisica TEXT,
    
    -- ClassificaÃ§Ã£o e critÃ©rios
    classificacao TEXT CHECK(classificacao IN ('Fiscal', 'ApropriaÃ§Ã£o', 'Operacional', 'TransferÃªncia CustÃ³dia')),
    frequencia_calibracao_anp INTEGER,
    criterio_aceitacao TEXT,
    erro_maximo_admissivel REAL,
    
    -- Fatores especÃ­ficos
    fator_k REAL, -- Para medidores de vazÃ£o
    diametro_nominal REAL, -- DN para medidores
    numero_fios INTEGER, -- Para PT-100 (2, 3 ou 4 fios)
    
    -- Software e versÃµes
    software_versao TEXT,
    firmware_versao TEXT,
    
    -- IntegraÃ§Ã£o e controle
    ativo_mxm BOOLEAN DEFAULT FALSE,
    numero_ativo_mxm TEXT,
    plano_manutencao_mxm TEXT,
    condicoes_ambientais TEXT,
    
    -- Status
    status_equipamento TEXT DEFAULT 'ativo',
    em_calibracao BOOLEAN DEFAULT FALSE,
    data_instalacao DATE,
    data_desativacao DATE,
    motivo_desativacao TEXT,
    
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (instalacao_id) REFERENCES instalacoes(instalacao_id),
    FOREIGN KEY (polo_id) REFERENCES polos(polo_id)
);

-- Tabela: pontos_medicao
CREATE TABLE pontos_medicao (
    ponto_medicao_id INTEGER PRIMARY KEY AUTOINCREMENT,
    equipamento_id INTEGER NOT NULL,
    tag_ponto_medicao TEXT UNIQUE NOT NULL,
    nome_ponto_medicao TEXT NOT NULL,
    
    -- ClassificaÃ§Ãµes
    classificacao_aplicacao TEXT CHECK(classificacao_aplicacao IN 
        ('Fiscal', 'ApropriaÃ§Ã£o', 'TransferÃªncia CustÃ³dia', 'Operacional')),
    classificacao_natureza TEXT CHECK(classificacao_natureza IN 
        ('Ã“leo', 'GÃ¡s Natural', 'Condensado', 'Ãgua')),
    
    -- LocalizaÃ§Ã£o e tipo
    localizacao TEXT,
    tipo_medidor_primario TEXT,
    sistema_medicao TEXT, -- Identificador do sistema
    
    -- Status e controle
    status_ponto TEXT DEFAULT 'ativo',
    ponto_critico BOOLEAN DEFAULT FALSE,
    observacoes TEXT,
    
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (equipamento_id) REFERENCES equipamentos(equipamento_id)
);
```

#### 3.1.3 Controle de CalibraÃ§Ãµes e Certificados

```sql
-- Tabela: plano_calibracao
CREATE TABLE plano_calibracao (
    calibracao_id INTEGER PRIMARY KEY AUTOINCREMENT,
    equipamento_id INTEGER NOT NULL,
    
    -- Datas de controle
    data_ultima_calibracao DATE,
    data_proxima_calibracao DATE,
    data_prevista_retirada DATE,
    data_prevista_retorno DATE,
    
    -- Status calculados
    dias_para_vencer INTEGER GENERATED ALWAYS AS 
        (julianday(data_proxima_calibracao) - julianday('now')) STORED,
    status_calibracao TEXT GENERATED ALWAYS AS (
        CASE 
            WHEN dias_para_vencer < 0 THEN 'vencido'
            WHEN dias_para_vencer <= 7 THEN 'critico'
            WHEN dias_para_vencer <= 30 THEN 'alerta'
            WHEN dias_para_vencer <= 90 THEN 'proximo'
            ELSE 'ok'
        END
    ) STORED,
    
    -- Certificados
    certificado_numero TEXT,
    certificado_revisao TEXT,
    certificado_path TEXT,
    certificado_status TEXT,
    
    -- LaboratÃ³rio e responsÃ¡vel
    laboratorio TEXT,
    laboratorio_acreditacao TEXT,
    responsavel_tecnico TEXT,
    
    -- Controle
    solicitacao_calibracao TEXT,
    ordem_servico TEXT,
    observacoes TEXT,
    
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (equipamento_id) REFERENCES equipamentos(equipamento_id)
);

-- Tabela: historico_calibracoes (expandida)
CREATE TABLE historico_calibracoes (
    historico_id INTEGER PRIMARY KEY AUTOINCREMENT,
    equipamento_id INTEGER NOT NULL,
    
    -- Dados da calibraÃ§Ã£o
    data_calibracao DATE NOT NULL,
    data_validade DATE,
    tipo_calibracao TEXT, -- Completa, Parcial, VerificaÃ§Ã£o
    
    -- Certificado
    certificado_numero TEXT,
    certificado_revisao TEXT,
    certificado_path TEXT,
    
    -- LaboratÃ³rio
    laboratorio TEXT,
    laboratorio_acreditacao TEXT,
    
    -- Resultados
    resultado TEXT CHECK(resultado IN ('Aprovado', 'Reprovado', 'Aprovado com RestriÃ§Ãµes')),
    
    -- Incertezas e erros
    incerteza_expandida REAL,
    incerteza_tipo TEXT,
    erro_maximo_encontrado REAL,
    
    -- Fator K histÃ³rico (para medidores de vazÃ£o)
    fator_k_anterior REAL,
    fator_k_novo REAL,
    
    -- Dados ambientais
    temperatura_calibracao REAL,
    umidade_calibracao REAL,
    pressao_calibracao REAL,
    
    -- Rastreabilidade
    padroes_utilizados TEXT,
    rastreabilidade_padroes TEXT,
    
    -- ResponsÃ¡veis
    executado_por TEXT,
    aprovado_por TEXT,
    
    observacoes TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (equipamento_id) REFERENCES equipamentos(equipamento_id)
);
```

#### 3.1.4 ValidaÃ§Ãµes e Controles MetrolÃ³gicos

```sql
-- Tabela: rm_equip (critÃ©rios de validaÃ§Ã£o)
CREATE TABLE rm_equip (
    rm_id INTEGER PRIMARY KEY AUTOINCREMENT,
    codigo_rm TEXT UNIQUE NOT NULL,
    descricao_criterio TEXT NOT NULL,
    tipo_equipamento TEXT,
    subtipo_equipamento TEXT,
    
    -- Limites e critÃ©rios
    limite_minimo REAL,
    limite_maximo REAL,
    unidade TEXT,
    formula_calculo TEXT,
    
    -- ReferÃªncias normativas
    norma_referencia TEXT,
    clausula_norma TEXT,
    
    -- Aplicabilidade
    classificacao_aplicavel TEXT, -- Fiscal, ApropriaÃ§Ã£o, etc
    obrigatorio BOOLEAN DEFAULT TRUE,
    
    ativo BOOLEAN DEFAULT TRUE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- Tabela: controle_incertezas
CREATE TABLE controle_incertezas (
    incerteza_id INTEGER PRIMARY KEY AUTOINCREMENT,
    equipamento_id INTEGER NOT NULL,
    ponto_medicao_id INTEGER,
    
    -- IdentificaÃ§Ã£o
    numero_relatorio TEXT,
    data_medicao DATE NOT NULL,
    numero_certificado TEXT,
    
    -- Valores de incerteza
    vazao_volumetrica REAL,
    incerteza_expandida REAL,
    incerteza_expandida_relativa REAL,
    fator_abrangencia REAL DEFAULT 2, -- k=2 para 95%
    
    -- CritÃ©rios e limites
    criterio_aceitacao_percentual REAL,
    limite_regulamentar REAL,
    
    -- ClassificaÃ§Ã£o
    tipo_incerteza TEXT,
    metodo_calculo TEXT, -- GUM, Monte Carlo, etc
    
    -- Status
    status TEXT GENERATED ALWAYS AS (
        CASE 
            WHEN incerteza_expandida_relativa <= criterio_aceitacao_percentual THEN 'aprovado'
            ELSE 'reprovado'
        END
    ) STORED,
    
    -- Detalhamento
    componentes_incerteza TEXT, -- JSON com breakdown
    observacoes TEXT,
    
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (equipamento_id) REFERENCES equipamentos(equipamento_id),
    FOREIGN KEY (ponto_medicao_id) REFERENCES pontos_medicao(ponto_medicao_id)
);

-- Tabela: incerteza_limite
CREATE TABLE incerteza_limite (
    limite_id INTEGER PRIMARY KEY AUTOINCREMENT,
    fluido TEXT NOT NULL,
    classificacao TEXT NOT NULL,
    aplicacao TEXT,
    
    -- Limites
    limite_percentual REAL NOT NULL,
    limite_absoluto REAL,
    
    -- ReferÃªncias
    norma_referencia TEXT,
    artigo_clausula TEXT,
    
    observacoes TEXT,
    ativo BOOLEAN DEFAULT TRUE,
    
    UNIQUE(fluido, classificacao, aplicacao)
);
```

#### 3.1.5 Equipamentos Especializados

```sql
-- Tabela: placas_orificio
CREATE TABLE placas_orificio (
    placa_id INTEGER PRIMARY KEY AUTOINCREMENT,
    equipamento_id INTEGER NOT NULL,
    
    -- IdentificaÃ§Ã£o
    numero_serie_stand_by TEXT, -- Placa reserva
    carta_numero TEXT,
    
    -- DimensÃµes crÃ­ticas @ 20Â°C
    diametro_externo_20c REAL, -- De
    diametro_orificio_20c REAL, -- dr
    espessura REAL, -- E
    diametro_nominal REAL, -- DN
    diametro_medio REAL, -- Dm
    diametro_real REAL, -- Dr
    
    -- CaracterÃ­sticas
    material TEXT,
    classe_pressao TEXT, -- ASA
    norma_fabricacao TEXT,
    beta_ratio REAL GENERATED ALWAYS AS 
        (diametro_orificio_20c / diametro_interno_tubo) STORED,
    
    -- Controle de uso
    data_fabricacao DATE,
    data_inspecao DATE,
    data_instalacao DATE,
    data_maxima_uso DATE,
    data_prevista_calibracao DATE,
    
    -- CertificaÃ§Ã£o
    certificado_dimensional TEXT,
    certificado_material TEXT,
    
    -- CritÃ©rios
    criterio_aceitacao TEXT,
    erro_maximo_admissivel REAL,
    
    observacoes TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (equipamento_id) REFERENCES equipamentos(equipamento_id)
);

-- Tabela: trechos_retos
CREATE TABLE trechos_retos (
    trecho_id INTEGER PRIMARY KEY AUTOINCREMENT,
    equipamento_id INTEGER NOT NULL,
    
    -- IdentificaÃ§Ã£o
    carta_numero TEXT,
    localizacao_sistema TEXT, -- Montante ou Jusante
    
    -- DimensÃµes @ 20Â°C
    diametro_nominal REAL, -- DN
    diametro_medio REAL, -- DM
    diametro_real REAL, -- DR
    comprimento REAL,
    
    -- CaracterÃ­sticas
    material_confeccao TEXT,
    classe_pressao TEXT,
    schedule TEXT,
    
    -- Componentes
    quantidade_tubos INTEGER,
    tem_junta BOOLEAN DEFAULT FALSE,
    tem_valvula BOOLEAN DEFAULT FALSE,
    tem_retificador BOOLEAN DEFAULT FALSE,
    numero_poco TEXT,
    
    -- Normas e inspeÃ§Ã£o
    normas_tecnicas TEXT,
    data_inspecao DATE,
    data_instalacao DATE,
    data_maxima_uso DATE,
    data_prevista_calibracao DATE,
    
    -- CertificaÃ§Ã£o
    certificado_dimensional TEXT,
    
    observacoes TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (equipamento_id) REFERENCES equipamentos(equipamento_id)
);

-- Tabela: valvulas
CREATE TABLE valvulas (
    valvula_id INTEGER PRIMARY KEY AUTOINCREMENT,
    equipamento_id INTEGER NOT NULL,
    
    -- IdentificaÃ§Ã£o
    tag_valvula TEXT UNIQUE NOT NULL,
    tipo_valvula TEXT,
    funcao_valvula TEXT, -- Bloqueio, Controle, AlÃ­vio, etc
    
    -- CaracterÃ­sticas tÃ©cnicas
    diametro_nominal REAL,
    classe_pressao TEXT,
    pressao_trabalho REAL,
    pressao_maxima REAL,
    
    -- ConstruÃ§Ã£o
    material_corpo TEXT,
    material_internos TEXT,
    tipo_acionamento TEXT, -- Manual, PneumÃ¡tico, ElÃ©trico, HidrÃ¡ulico
    tipo_sede TEXT,
    tipo_vedacao TEXT,
    
    -- Teste de estanqueidade
    teste_estanqueidade_periodicidade INTEGER, -- dias
    data_ultimo_teste DATE,
    data_proximo_teste DATE,
    resultado_ultimo_teste TEXT,
    taxa_vazamento REAL,
    
    -- Status
    status_valvula TEXT DEFAULT 'operacional',
    posicao_normal TEXT, -- NA, NF, VariÃ¡vel
    
    observacoes TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (equipamento_id) REFERENCES equipamentos(equipamento_id)
);
```

#### 3.1.6 Controle de PoÃ§os e AnÃ¡lises

```sql
-- Tabela: cadastro_poco
CREATE TABLE cadastro_poco (
    poco_id INTEGER PRIMARY KEY AUTOINCREMENT,
    codigo_poco TEXT UNIQUE NOT NULL,
    polo_id INTEGER NOT NULL,
    instalacao_id INTEGER NOT NULL,
    
    -- IdentificaÃ§Ã£o
    nome_poco TEXT NOT NULL,
    tipo_poco TEXT, -- Produtor, Injetor, etc
    codigo_anp TEXT UNIQUE,
    
    -- CaracterÃ­sticas
    profundidade REAL,
    diametro TEXT,
    completacao TEXT,
    
    -- FrequÃªncias de teste
    frequencia_teste_dias INTEGER DEFAULT 90,
    frequencia_analise_dias INTEGER,
    
    -- Status
    status_poco TEXT DEFAULT 'ativo',
    data_ativacao DATE,
    data_desativacao DATE,
    
    observacoes TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (polo_id) REFERENCES polos(polo_id),
    FOREIGN KEY (instalacao_id) REFERENCES instalacoes(instalacao_id)
);

-- Tabela: teste_poco (BTP expandida)
CREATE TABLE teste_poco (
    teste_id INTEGER PRIMARY KEY AUTOINCREMENT,
    poco_id INTEGER NOT NULL,
    
    -- IdentificaÃ§Ã£o do teste
    data_teste DATE NOT NULL,
    numero_btp TEXT UNIQUE,
    tipo_teste TEXT DEFAULT 'BTP',
    tag_medidor_oleo TEXT,
    
    -- Resultados do teste
    vazao_oleo REAL, -- mÂ³/d
    vazao_gas REAL, -- mil mÂ³/d
    vazao_agua REAL, -- mÂ³/d
    bsw REAL CHECK(bsw >= 0 AND bsw <= 100), -- %
    rgo REAL, -- RazÃ£o GÃ¡s-Ã“leo
    pressao_cabeca REAL, -- kgf/cmÂ²
    temperatura_teste REAL, -- Â°C
    
    -- DocumentaÃ§Ã£o
    arquivo_btp_path TEXT,
    rt_numero TEXT,
    data_rt DATE,
    bra_numero TEXT,
    
    -- Controle
    data_desembarque DATE,
    data_recebimento_btp DATE,
    data_envio_resultado DATE,
    
    -- ValidaÃ§Ã£o
    validado BOOLEAN DEFAULT FALSE,
    validado_por TEXT,
    data_validacao DATE,
    
    -- AtualizaÃ§Ã£o
    atualizacao_potencial BOOLEAN DEFAULT FALSE,
    data_atualizacao_potencial DATE,
    
    -- ResponsÃ¡veis
    responsavel_teste TEXT,
    aprovado_por TEXT,
    
    status_teste TEXT DEFAULT 'realizado',
    observacoes TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (poco_id) REFERENCES cadastro_poco(poco_id)
);

-- Tabela: analises_quimicas (FQ expandida)
CREATE TABLE analises_quimicas (
    analise_id INTEGER PRIMARY KEY AUTOINCREMENT,
    ponto_medicao_id INTEGER,
    poco_id INTEGER,
    
    -- IdentificaÃ§Ã£o
    data_coleta DATE NOT NULL,
    tipo_analise TEXT,
    natureza_fluido TEXT,
    tag_ponto_medicao TEXT,
    
    -- Coleta
    sot_numero TEXT, -- SolicitaÃ§Ã£o de Trabalho
    cilindro_numero TEXT,
    metodo_coleta TEXT,
    responsavel_coleta TEXT,
    
    -- LaboratÃ³rio
    laboratorio TEXT,
    data_envio_lab DATE,
    data_recebimento_lab DATE,
    
    -- Resultados
    rt_numero TEXT,
    data_rt DATE,
    data_resultado DATE,
    
    -- ParÃ¢metros analisados (JSON)
    parametros_analisados TEXT, -- JSON com todos os parÃ¢metros
    
    -- Principais resultados
    densidade_20c REAL,
    bsw_karl_fischer REAL,
    salinidade REAL,
    poder_calorifico_superior REAL,
    poder_calorifico_inferior REAL,
    
    -- DocumentaÃ§Ã£o
    arquivo_resultado_path TEXT,
    bra_numero TEXT,
    
    -- ValidaÃ§Ã£o
    validado BOOLEAN DEFAULT FALSE,
    validado_por TEXT,
    data_validacao DATE,
    
    -- AtualizaÃ§Ã£o CV
    atualizacao_cv BOOLEAN DEFAULT FALSE,
    data_atualizacao_cv DATE,
    
    status_analise TEXT DEFAULT 'em_andamento',
    observacoes TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (ponto_medicao_id) REFERENCES pontos_medicao(ponto_medicao_id),
    FOREIGN KEY (poco_id) REFERENCES cadastro_poco(poco_id)
);

-- Tabela: plano_coleta
CREATE TABLE plano_coleta (
    coleta_id INTEGER PRIMARY KEY AUTOINCREMENT,
    ponto_medicao_id INTEGER,
    tipo_coleta TEXT, -- FQ, Especial, etc
    
    -- Planejamento
    data_programada DATE,
    periodicidade_dias INTEGER,
    
    -- LogÃ­stica
    data_embarque DATE,
    data_desembarque DATE,
    
    -- ValidaÃ§Ãµes
    validado_operacao BOOLEAN DEFAULT FALSE,
    validado_laboratorio BOOLEAN DEFAULT FALSE,
    
    -- Recursos
    cilindros_disponiveis BOOLEAN DEFAULT FALSE,
    quantidade_cilindros INTEGER,
    
    -- ExecuÃ§Ã£o
    embarque_agendado BOOLEAN DEFAULT FALSE,
    embarque_realizado BOOLEAN DEFAULT FALSE,
    coleta_realizada BOOLEAN DEFAULT FALSE,
    resultado_emitido BOOLEAN DEFAULT FALSE,
    
    data_real_embarque DATE,
    data_real_coleta DATE,
    
    responsavel TEXT,
    observacoes TEXT,
    status TEXT DEFAULT 'planejado',
    
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (ponto_medicao_id) REFERENCES pontos_medicao(ponto_medicao_id)
);

-- Tabela: regra_analises_fq
CREATE TABLE regra_analises_fq (
    regra_id INTEGER PRIMARY KEY AUTOINCREMENT,
    fluido TEXT NOT NULL,
    tipo_analise TEXT NOT NULL,
    
    -- Periodicidade
    periodicidade_dias INTEGER NOT NULL,
    periodicidade_tipo TEXT, -- Fixa, VariÃ¡vel
    
    -- IdentificaÃ§Ã£o
    sigla TEXT,
    codigo_analise TEXT,
    
    -- RegulamentaÃ§Ã£o
    regulamento TEXT,
    artigo_clausula TEXT,
    
    -- ParÃ¢metros obrigatÃ³rios
    parametros_obrigatorios TEXT, -- JSON com lista
    
    -- Aplicabilidade
    aplicavel_fiscal BOOLEAN DEFAULT TRUE,
    aplicavel_apropriacao BOOLEAN DEFAULT TRUE,
    aplicavel_operacional BOOLEAN DEFAULT FALSE,
    
    observacoes TEXT,
    ativo BOOLEAN DEFAULT TRUE,
    
    UNIQUE(fluido, tipo_analise)
);
```

#### 3.1.7 GestÃ£o de MovimentaÃ§Ã£o e LogÃ­stica

```sql
-- Tabela: movimentacao_equipamentos
CREATE TABLE movimentacao_equipamentos (
    movimentacao_id INTEGER PRIMARY KEY AUTOINCREMENT,
    equipamento_id INTEGER NOT NULL,
    
    -- Tipo de movimentaÃ§Ã£o
    tipo_movimentacao TEXT CHECK(tipo_movimentacao IN 
        ('Retirada', 'InstalaÃ§Ã£o', 'TransferÃªncia', 'Envio Lab', 'Retorno Lab')),
    
    -- Origem e destino
    local_origem TEXT,
    local_destino TEXT,
    instalacao_origem_id INTEGER,
    instalacao_destino_id INTEGER,
    
    -- Datas
    data_movimentacao DATE NOT NULL,
    data_prevista_retorno DATE,
    data_efetiva_retorno DATE,
    
    -- DocumentaÃ§Ã£o
    numero_remessa TEXT,
    numero_nota_fiscal TEXT,
    transportadora TEXT,
    
    -- Motivo
    motivo TEXT,
    ordem_servico TEXT,
    solicitante TEXT,
    
    -- ResponsÃ¡veis
    retirado_por TEXT,
    autorizado_por TEXT,
    recebido_por TEXT,
    
    -- Status
    status_movimentacao TEXT DEFAULT 'em_transito',
    equipamento_substituto_id INTEGER,
    
    observacoes TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (equipamento_id) REFERENCES equipamentos(equipamento_id),
    FOREIGN KEY (instalacao_origem_id) REFERENCES instalacoes(instalacao_id),
    FOREIGN KEY (instalacao_destino_id) REFERENCES instalacoes(instalacao_id),
    FOREIGN KEY (equipamento_substituto_id) REFERENCES equipamentos(equipamento_id)
);

-- Tabela: estoque_sobressalentes
CREATE TABLE estoque_sobressalentes (
    estoque_id INTEGER PRIMARY KEY AUTOINCREMENT,
    equipamento_id INTEGER NOT NULL,
    
    -- LocalizaÃ§Ã£o
    local_armazenamento TEXT,
    posicao_estoque TEXT,
    instalacao_id INTEGER,
    
    -- Status
    disponivel BOOLEAN DEFAULT TRUE,
    condicao TEXT CHECK(condicao IN ('Novo', 'Usado', 'Recondicionado')),
    
    -- Controle
    data_entrada DATE,
    origem TEXT,
    proxima_calibracao DATE,
    
    observacoes TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (equipamento_id) REFERENCES equipamentos(equipamento_id),
    FOREIGN KEY (instalacao_id) REFERENCES instalacoes(instalacao_id)
);
```

#### 3.1.8 GestÃ£o de NÃ£o Conformidades e MOC

```sql
-- Tabela: nao_conformidades
CREATE TABLE nao_conformidades (
    nc_id INTEGER PRIMARY KEY AUTOINCREMENT,
    
    -- IdentificaÃ§Ã£o
    numero_nc TEXT UNIQUE NOT NULL,
    data_abertura DATE NOT NULL,
    tipo_nc TEXT CHECK(tipo_nc IN ('Maior', 'Menor', 'ObservaÃ§Ã£o')),
    origem TEXT CHECK(origem IN ('Auditoria', 'InspeÃ§Ã£o', 'OperaÃ§Ã£o', 'Cliente')),
    
    -- Relacionamentos
    equipamento_id INTEGER,
    ponto_medicao_id INTEGER,
    instalacao_id INTEGER,
    
    -- DescriÃ§Ã£o
    titulo TEXT NOT NULL,
    descricao_nc TEXT NOT NULL,
    requisito_violado TEXT,
    norma_referencia TEXT,
    
    -- AnÃ¡lise de causa raiz
    metodo_analise TEXT, -- 5 PorquÃªs, Ishikawa, etc
    causa_raiz TEXT,
    analise_detalhada TEXT,
    
    -- Impacto
    impacto_operacional TEXT,
    impacto_medicao TEXT,
    severidade TEXT CHECK(severidade IN ('Baixa', 'MÃ©dia', 'Alta', 'CrÃ­tica')),
    
    -- ResponsÃ¡veis
    identificado_por TEXT,
    responsavel_analise TEXT,
    responsavel_solucao TEXT,
    
    -- Prazos
    prazo_resposta DATE,
    prazo_solucao DATE,
    data_fechamento DATE,
    
    -- Status
    status_nc TEXT DEFAULT 'aberta',
    
    observacoes TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (equipamento_id) REFERENCES equipamentos(equipamento_id),
    FOREIGN KEY (ponto_medicao_id) REFERENCES pontos_medicao(ponto_medicao_id),
    FOREIGN KEY (instalacao_id) REFERENCES instalacoes(instalacao_id)
);

-- Tabela: acoes_corretivas
CREATE TABLE acoes_corretivas (
    acao_id INTEGER PRIMARY KEY AUTOINCREMENT,
    nc_id INTEGER NOT NULL,
    
    -- IdentificaÃ§Ã£o
    numero_acao TEXT,
    tipo_acao TEXT CHECK(tipo_acao IN ('CorreÃ§Ã£o', 'Corretiva', 'Preventiva')),
    
    -- DescriÃ§Ã£o
    descricao_acao TEXT NOT NULL,
    resultado_esperado TEXT,
    
    -- ResponsÃ¡vel e prazo
    responsavel TEXT,
    prazo_execucao DATE,
    
    -- ExecuÃ§Ã£o
    data_inicio DATE,
    data_conclusao DATE,
    status_acao TEXT DEFAULT 'planejada',
    
    -- VerificaÃ§Ã£o
    eficaz BOOLEAN,
    verificado_por TEXT,
    data_verificacao DATE,
    evidencias TEXT,
    
    observacoes TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (nc_id) REFERENCES nao_conformidades(nc_id)
);

-- Tabela: moc_controle_mudancas
CREATE TABLE moc_controle_mudancas (
    moc_id INTEGER PRIMARY KEY AUTOINCREMENT,
    
    -- IdentificaÃ§Ã£o
    numero_moc TEXT UNIQUE NOT NULL,
    data_solicitacao DATE NOT NULL,
    tipo_mudanca TEXT CHECK(tipo_mudanca IN ('TemporÃ¡ria', 'Permanente')),
    categoria TEXT CHECK(categoria IN ('Equipamento', 'Procedimento', 'Software', 'InstalaÃ§Ã£o')),
    
    -- Relacionamentos
    equipamento_id INTEGER,
    instalacao_id INTEGER,
    
    -- DescriÃ§Ã£o
    titulo TEXT NOT NULL,
    descricao_mudanca TEXT NOT NULL,
    justificativa TEXT NOT NULL,
    
    -- AnÃ¡lise de impacto
    impacto_metrologia TEXT,
    impacto_seguranca TEXT,
    impacto_operacional TEXT,
    impacto_regulatorio TEXT,
    analise_risco TEXT,
    
    -- AprovaÃ§Ãµes
    solicitante TEXT,
    aprovador_tecnico TEXT,
    data_aprovacao_tecnica DATE,
    aprovador_gerencial TEXT,
    data_aprovacao_gerencial DATE,
    
    -- ImplementaÃ§Ã£o
    responsavel_implementacao TEXT,
    data_inicio_implementacao DATE,
    data_conclusao_implementacao DATE,
    
    -- ValidaÃ§Ã£o
    validacao_necessaria BOOLEAN DEFAULT TRUE,
    responsavel_validacao TEXT,
    data_validacao DATE,
    resultado_validacao TEXT,
    
    -- DocumentaÃ§Ã£o
    documentos_alterados TEXT, -- JSON com lista
    procedimentos_atualizados TEXT, -- JSON com lista
    treinamento_necessario BOOLEAN DEFAULT FALSE,
    
    -- Status
    status_moc TEXT DEFAULT 'solicitada',
    
    observacoes TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (equipamento_id) REFERENCES equipamentos(equipamento_id),
    FOREIGN KEY (instalacao_id) REFERENCES instalacoes(instalacao_id)
);
```

#### 3.1.9 Tabelas de ConfiguraÃ§Ã£o e Listas

```sql
-- Tabela: configuracoes_sistema
CREATE TABLE configuracoes_sistema (
    config_id INTEGER PRIMARY KEY AUTOINCREMENT,
    categoria TEXT NOT NULL,
    chave TEXT NOT NULL,
    valor TEXT,
    tipo_valor TEXT, -- string, number, boolean, json
    descricao TEXT,
    modificavel_usuario BOOLEAN DEFAULT TRUE,
    
    UNIQUE(categoria, chave)
);

-- Tabela: listas_selecao
CREATE TABLE listas_selecao (
    lista_id INTEGER PRIMARY KEY AUTOINCREMENT,
    tipo_lista TEXT NOT NULL,
    valor TEXT NOT NULL,
    descricao TEXT,
    ordem INTEGER,
    ativo BOOLEAN DEFAULT TRUE,
    
    UNIQUE(tipo_lista, valor)
);

-- Valores iniciais para listas_selecao
INSERT INTO listas_selecao (tipo_lista, valor) VALUES
    ('fabricante', 'Emerson'),
    ('fabricante', 'Yokogawa'),
    ('fabricante', 'ABB'),
    ('fabricante', 'Endress+Hauser'),
    ('tipo_equipamento', 'Medidor PrimÃ¡rio'),
    ('tipo_equipamento', 'Transmissor'),
    ('tipo_equipamento', 'Sensor'),
    ('tipo_equipamento', 'Computador de VazÃ£o'),
    ('classificacao', 'Fiscal'),
    ('classificacao', 'ApropriaÃ§Ã£o'),
    ('classificacao', 'Operacional'),
    ('fluido', 'Ã“leo'),
    ('fluido', 'GÃ¡s Natural'),
    ('fluido', 'Condensado'),
    ('fluido', 'Ãgua');
```

### 3.2 Triggers e ValidaÃ§Ãµes AutomÃ¡ticas

```sql
-- Trigger: Atualizar timestamp
CREATE TRIGGER update_timestamp_equipamentos
AFTER UPDATE ON equipamentos
BEGIN
    UPDATE equipamentos 
    SET updated_at = CURRENT_TIMESTAMP 
    WHERE equipamento_id = NEW.equipamento_id;
END;

-- Trigger: Calcular prÃ³xima calibraÃ§Ã£o
CREATE TRIGGER calcular_proxima_calibracao
AFTER UPDATE OF data_ultima_calibracao ON plano_calibracao
BEGIN
    UPDATE plano_calibracao 
    SET data_proxima_calibracao = date(NEW.data_ultima_calibracao, 
        '+' || (SELECT frequencia_calibracao_anp FROM equipamentos 
                WHERE equipamento_id = NEW.equipamento_id) || ' days')
    WHERE calibracao_id = NEW.calibracao_id;
END;

-- Trigger: Validar incerteza contra limites
CREATE TRIGGER validar_incerteza_limite
BEFORE INSERT ON controle_incertezas
BEGIN
    SELECT CASE
        WHEN NEW.incerteza_expandida_relativa > (
            SELECT limite_percentual 
            FROM incerteza_limite 
            WHERE fluido = (SELECT unidade_medida FROM equipamentos 
                          WHERE equipamento_id = NEW.equipamento_id)
            AND classificacao = (SELECT classificacao FROM equipamentos 
                               WHERE equipamento_id = NEW.equipamento_id)
        )
        THEN RAISE(ABORT, 'Incerteza excede limite regulamentar')
    END;
END;

-- Trigger: Atualizar status de poÃ§o apÃ³s teste
CREATE TRIGGER atualizar_poco_apos_teste
AFTER INSERT ON teste_poco
BEGIN
    UPDATE cadastro_poco
    SET updated_at = CURRENT_TIMESTAMP
    WHERE poco_id = NEW.poco_id;
END;

-- Trigger: Log de movimentaÃ§Ã£o ao alterar localizaÃ§Ã£o
CREATE TRIGGER log_movimentacao_equipamento
AFTER UPDATE OF instalacao_id ON equipamentos
WHEN OLD.instalacao_id != NEW.instalacao_id
BEGIN
    INSERT INTO movimentacao_equipamentos (
        equipamento_id,
        tipo_movimentacao,
        instalacao_origem_id,
        instalacao_destino_id,
        data_movimentacao,
        motivo,
        status_movimentacao
    ) VALUES (
        NEW.equipamento_id,
        'TransferÃªncia',
        OLD.instalacao_id,
        NEW.instalacao_id,
        CURRENT_TIMESTAMP,
        'TransferÃªncia automÃ¡tica registrada',
        'concluÃ­da'
    );
END;

-- Trigger: Validar Fator K em medidores
CREATE TRIGGER validar_fator_k
BEFORE UPDATE OF fator_k ON equipamentos
WHEN NEW.subtipo_equipamento IN ('coriolis', 'turbina', 'ultrasonico')
BEGIN
    SELECT CASE
        WHEN NEW.fator_k IS NULL OR NEW.fator_k <= 0
        THEN RAISE(ABORT, 'Fator K invÃ¡lido para medidor de vazÃ£o')
    END;
END;
```

---

## ğŸ”„ 4. FLUXOGRAMAS DE PROCESSOS

### 4.1 Fluxo Principal do Sistema

```mermaid
graph TD
    A[InicializaÃ§Ã£o] --> B[Dashboard Principal]
    B --> C{Menu Principal}
    
    C --> D[GestÃ£o de Equipamentos]
    C --> E[Controle de CalibraÃ§Ãµes]
    C --> F[GestÃ£o de PoÃ§os]
    C --> G[AnÃ¡lises QuÃ­micas]
    C --> H[RelatÃ³rios]
    C --> I[ConfiguraÃ§Ãµes]
    
    D --> D1[Cadastro/EdiÃ§Ã£o]
    D --> D2[MovimentaÃ§Ã£o]
    D --> D3[HistÃ³rico]
    
    E --> E1[Plano de CalibraÃ§Ã£o]
    E --> E2[Certificados]
    E --> E3[Incertezas]
    
    F --> F1[Cadastro de PoÃ§os]
    F --> F2[Testes BTP]
    F --> F3[Cronograma]
    
    G --> G1[Plano de Coleta]
    G --> G2[Resultados]
    G --> G3[ValidaÃ§Ã£o]
```

### 4.2 Fluxo de CalibraÃ§Ã£o Completo

```
1. MONITORAMENTO DIÃRIO
   â””â”€> Sistema verifica vencimentos
   
2. ALERTAS AUTOMÃTICOS
   â”œâ”€> 90 dias antes: Planejamento
   â”œâ”€> 30 dias antes: PreparaÃ§Ã£o
   â”œâ”€> 7 dias antes: Urgente
   â””â”€> Vencido: CrÃ­tico

3. RETIRADA DO EQUIPAMENTO
   â”œâ”€> Registro de movimentaÃ§Ã£o
   â”œâ”€> InstalaÃ§Ã£o de sobressalente
   â””â”€> AtualizaÃ§Ã£o de status

4. ENVIO PARA CALIBRAÃ‡ÃƒO
   â”œâ”€> SeleÃ§Ã£o de laboratÃ³rio
   â”œâ”€> GeraÃ§Ã£o de OS
   â””â”€> Controle de prazo

5. RETORNO E VALIDAÃ‡ÃƒO
   â”œâ”€> Recebimento do equipamento
   â”œâ”€> AnÃ¡lise do certificado
   â”œâ”€> ValidaÃ§Ã£o de incertezas
   â””â”€> AprovaÃ§Ã£o/ReprovaÃ§Ã£o

6. REINSTALAÃ‡ÃƒO
   â”œâ”€> Registro de instalaÃ§Ã£o
   â”œâ”€> AtualizaÃ§Ã£o de dados
   â””â”€> LiberaÃ§Ã£o para operaÃ§Ã£o
```

### 4.3 Fluxo de GestÃ£o de MudanÃ§as (MOC)

```
1. SOLICITAÃ‡ÃƒO
   â”œâ”€> IdentificaÃ§Ã£o da necessidade
   â”œâ”€> Preenchimento do MOC
   â””â”€> Justificativa tÃ©cnica

2. ANÃLISE DE IMPACTO
   â”œâ”€> Impacto metrolÃ³gico
   â”œâ”€> Impacto regulatÃ³rio
   â”œâ”€> Impacto operacional
   â””â”€> AnÃ¡lise de risco

3. APROVAÃ‡Ã•ES
   â”œâ”€> AprovaÃ§Ã£o tÃ©cnica
   â”œâ”€> AprovaÃ§Ã£o gerencial
   â””â”€> AprovaÃ§Ã£o regulatÃ³ria

4. IMPLEMENTAÃ‡ÃƒO
   â”œâ”€> Planejamento
   â”œâ”€> ExecuÃ§Ã£o
   â”œâ”€> DocumentaÃ§Ã£o
   â””â”€> Treinamento

5. VALIDAÃ‡ÃƒO
   â”œâ”€> Testes de aceitaÃ§Ã£o
   â”œâ”€> VerificaÃ§Ã£o de conformidade
   â””â”€> Fechamento do MOC
```

---

## ğŸ“Š 5. FUNCIONALIDADES DETALHADAS

### 5.1 Dashboard Principal

#### 5.1.1 Widgets e KPIs
```typescript
interface DashboardMetrics {
  // Conformidade
  compliance: {
    fiscal: number;          // % equipamentos fiscais conformes
    apropriacao: number;     // % equipamentos apropriaÃ§Ã£o conformes
    operacional: number;     // % equipamentos operacionais conformes
    global: number;          // % conformidade geral
  };
  
  // Alertas por criticidade
  alerts: {
    vencidos: Equipment[];   // Lista de equipamentos vencidos
    criticos: Equipment[];   // Vencimento < 7 dias
    alertas: Equipment[];    // Vencimento < 30 dias
    proximos: Equipment[];   // Vencimento < 90 dias
  };
  
  // CalibraÃ§Ãµes
  calibrations: {
    realizadas_mes: number;
    programadas_mes: number;
    atrasadas: number;
    em_andamento: number;
  };
  
  // PoÃ§os
  wells: {
    testes_realizados: number;
    testes_pendentes: number;
    proximos_30_dias: number;
  };
  
  // AnÃ¡lises QuÃ­micas
  chemistry: {
    coletas_programadas: number;
    analises_em_lab: number;
    resultados_pendentes: number;
  };
  
  // Performance
  performance: {
    disponibilidade: number;  // % equipamentos disponÃ­veis
    mtbf: number;            // Mean Time Between Failures
    tempo_medio_calibracao: number; // dias
  };
}
```

#### 5.1.2 Sistema de Cores e Alertas
```javascript
const AlertColors = {
  ok: '#4CAF50',        // Verde - Conforme
  proximo: '#2196F3',   // Azul - AtenÃ§Ã£o futura
  alerta: '#FF9800',    // Laranja - AtenÃ§Ã£o
  critico: '#F44336',   // Vermelho - CrÃ­tico
  vencido: '#9E9E9E'    // Cinza - Vencido
};

const AlertRules = {
  fiscal: {
    critico: 7,   // dias
    alerta: 15,   // dias
    proximo: 30   // dias
  },
  apropriacao: {
    critico: 15,
    alerta: 30,
    proximo: 60
  },
  operacional: {
    critico: 30,
    alerta: 60,
    proximo: 90
  }
};
```

### 5.2 GestÃ£o de Equipamentos

#### 5.2.1 Cadastro Inteligente
- **Auto-preenchimento**: Baseado em modelo e fabricante
- **ValidaÃ§Ã£o em tempo real**: NÃºmero de sÃ©rie Ãºnico
- **CÃ¡lculo automÃ¡tico**: FrequÃªncias baseadas em classificaÃ§Ã£o
- **VinculaÃ§Ã£o inteligente**: SugestÃ£o de ponto de mediÃ§Ã£o

#### 5.2.2 GestÃ£o de Fator K
```typescript
interface FatorKManagement {
  // Para medidores de vazÃ£o
  medidor_id: number;
  tipo_medidor: 'coriolis' | 'turbina' | 'ultrasonico';
  
  // Valores de Fator K
  fator_k_nominal: number;
  fator_k_atual: number;
  
  // HistÃ³rico
  historico: Array<{
    data: Date;
    fator_k_anterior: number;
    fator_k_novo: number;
    certificado: string;
    motivo_alteracao: string;
  }>;
  
  // ValidaÃ§Ã£o
  desvio_maximo_permitido: number; // %
  alerta_desvio: boolean;
}
```

#### 5.2.3 Controle de MovimentaÃ§Ã£o
- **Rastreamento completo**: Origem â†’ Transporte â†’ Destino
- **SubstituiÃ§Ã£o automÃ¡tica**: GestÃ£o de sobressalentes
- **HistÃ³rico de localizaÃ§Ã£o**: Timeline de movimentaÃ§Ãµes
- **IntegraÃ§Ã£o com calibraÃ§Ã£o**: Link com envio para laboratÃ³rio

### 5.3 Controle de CalibraÃ§Ãµes

#### 5.3.1 Planejamento Otimizado
```typescript
interface CalibrationPlanning {
  // OtimizaÃ§Ã£o por rota
  groupByLocation: boolean;
  
  // OtimizaÃ§Ã£o por tipo
  groupByType: boolean;
  
  // OtimizaÃ§Ã£o por laboratÃ³rio
  groupByLab: boolean;
  
  // ConsideraÃ§Ãµes
  considerMinimumBatch: number; // MÃ­nimo de equipamentos
  considerShutdownWindows: boolean; // Paradas programadas
  considerResourceAvailability: boolean; // Disponibilidade de recursos
}
```

#### 5.3.2 ValidaÃ§Ã£o de Certificados
- **OCR automÃ¡tico**: ExtraÃ§Ã£o de dados do PDF (futuro)
- **ValidaÃ§Ã£o de campos**: Completude e consistÃªncia
- **VerificaÃ§Ã£o de acreditaÃ§Ã£o**: LaboratÃ³rio vÃ¡lido
- **CÃ¡lculo de incerteza**: Conformidade com limites

### 5.4 GestÃ£o de PoÃ§os (BTP)

#### 5.4.1 Controle de Testes
```typescript
interface WellTest {
  // IdentificaÃ§Ã£o
  poco_id: number;
  data_teste: Date;
  numero_btp: string;
  
  // MediÃ§Ãµes obrigatÃ³rias
  vazao_oleo: number;      // mÂ³/d
  vazao_gas: number;       // mil mÂ³/d
  vazao_agua: number;      // mÂ³/d
  bsw: number;             // % (0-100)
  rgo: number;             // RazÃ£o GÃ¡s-Ã“leo
  
  // ValidaÃ§Ãµes
  validacoes: {
    vazoes_positivas: boolean;
    bsw_range: boolean;
    rgo_coerente: boolean;
    arquivo_anexado: boolean;
  };
  
  // Alertas
  proximo_teste: Date;
  dias_para_vencer: number;
  alerta_ativo: boolean;
}
```

#### 5.4.2 Dashboard de PoÃ§os
- **Timeline visual**: Testes realizados e programados
- **GrÃ¡ficos de tendÃªncia**: EvoluÃ§Ã£o de produÃ§Ã£o
- **Alertas preventivos**: 30, 15, 7 dias antes
- **AnÃ¡lise comparativa**: Performance entre poÃ§os

### 5.5 AnÃ¡lises QuÃ­micas (FQ)

#### 5.5.1 GestÃ£o de Coletas
- **Planejamento anual**: Baseado em periodicidade
- **Controle de cilindros**: Disponibilidade e rastreamento
- **LogÃ­stica integrada**: Embarque e desembarque
- **Chain of custody**: Rastreabilidade completa

#### 5.5.2 Resultados e ValidaÃ§Ã£o
```typescript
interface ChemicalAnalysis {
  // ParÃ¢metros principais
  densidade_20c: number;
  bsw_karl_fischer: number;
  salinidade: number;
  poder_calorifico_superior: number;
  poder_calorifico_inferior: number;
  
  // ComposiÃ§Ã£o (%)
  composicao: {
    metano: number;
    etano: number;
    propano: number;
    butano: number;
    pentano_plus: number;
    co2: number;
    n2: number;
    h2s: number;
  };
  
  // ValidaÃ§Ã£o
  limites_atendidos: boolean;
  desvio_historico: number;
  aprovado_para_cv: boolean;
}
```

### 5.6 GestÃ£o de NÃ£o Conformidades

#### 5.6.1 Registro e AnÃ¡lise
- **ClassificaÃ§Ã£o automÃ¡tica**: Maior, Menor, ObservaÃ§Ã£o
- **AnÃ¡lise de causa raiz**: 5 PorquÃªs, Ishikawa
- **Impacto assessment**: Operacional, MetrolÃ³gico, RegulatÃ³rio
- **Workflow de aprovaÃ§Ã£o**: MÃºltiplos nÃ­veis

#### 5.6.2 AÃ§Ãµes Corretivas
- **Planejamento estruturado**: AÃ§Ãµes com responsÃ¡veis e prazos
- **Acompanhamento**: Status e progresso
- **VerificaÃ§Ã£o de eficÃ¡cia**: ValidaÃ§Ã£o pÃ³s-implementaÃ§Ã£o
- **PrevenÃ§Ã£o de recorrÃªncia**: AnÃ¡lise de tendÃªncias

### 5.7 MOC - Controle de MudanÃ§as

#### 5.7.1 Workflow de AprovaÃ§Ã£o
```
SOLICITANTE â†’ TÃ‰CNICO â†’ GERENCIAL â†’ IMPLEMENTAÃ‡ÃƒO â†’ VALIDAÃ‡ÃƒO
     â†“           â†“          â†“            â†“             â†“
  Proposta    AnÃ¡lise   AprovaÃ§Ã£o   ExecuÃ§Ã£o    VerificaÃ§Ã£o
```

#### 5.7.2 DocumentaÃ§Ã£o e Rastreabilidade
- **Versionamento**: Controle de revisÃµes de documentos
- **Impacto mapping**: IdentificaÃ§Ã£o de Ã¡reas afetadas
- **Training matrix**: Necessidades de treinamento
- **Audit trail**: HistÃ³rico completo de alteraÃ§Ãµes

---

## ğŸ“± 6. MÃ“DULO MOBILE (Consulta)

### 6.1 CaracterÃ­sticas
- **Read-only**: Apenas consulta, sem ediÃ§Ã£o
- **PWA**: Progressive Web App (nÃ£o nativo)
- **Offline capable**: Cache local para consultas offline
- **Responsive**: Adaptado para tablets e smartphones

### 6.2 Funcionalidades Mobile
```typescript
interface MobileFeatures {
  // Consultas disponÃ­veis
  consultarEquipamento: (tag: string) => Equipment;
  consultarCertificado: (numero: string) => Certificate;
  verificarVencimentos: () => Alert[];
  visualizarDashboard: () => DashboardMetrics;
  
  // QR Code
  scanQRCode: () => string; // Retorna TAG do equipamento
  
  // SincronizaÃ§Ã£o
  syncOfflineData: () => void;
  lastSyncTime: Date;
}
```

---

## ğŸ“ˆ 7. RELATÃ“RIOS E EXPORTAÃ‡Ã•ES

### 7.1 RelatÃ³rios Regulamentares

#### 7.1.1 RelatÃ³rio ANP Mensal
- **ConteÃºdo obrigatÃ³rio**:
  - Lista de equipamentos fiscais
  - Status de calibraÃ§Ã£o
  - Certificados vigentes
  - Incertezas calculadas
  - NÃ£o conformidades
  - AÃ§Ãµes corretivas

#### 7.1.2 RelatÃ³rio ISO 17025
- **EvidÃªncias de conformidade**:
  - Rastreabilidade metrolÃ³gica
  - CompetÃªncia tÃ©cnica
  - Imparcialidade
  - Confidencialidade
  - GestÃ£o de riscos

### 7.2 ExportaÃ§Ãµes

#### 7.2.1 Formatos Suportados
```typescript
interface ExportFormats {
  excel: {
    extension: '.xlsx';
    templates: ['ANP', 'ISO', 'Gerencial', 'Custom'];
    formatting: boolean; // Cores, bordas, etc
  };
  
  pdf: {
    extension: '.pdf';
    headers: boolean;
    footers: boolean;
    watermark: boolean;
    signature: boolean;
  };
  
  csv: {
    extension: '.csv';
    delimiter: ',' | ';';
    encoding: 'UTF-8' | 'ISO-8859-1';
  };
}
```

---

## ğŸ” 8. REQUISITOS NÃƒO FUNCIONAIS

### 8.1 Performance
- **Tempo de resposta**: < 2 segundos para consultas
- **Capacidade**: 10.000+ equipamentos
- **ConcorrÃªncia**: Mono-usuÃ¡rio (sem concorrÃªncia)
- **Backup**: < 5 minutos para backup completo

### 8.2 SeguranÃ§a
- **AutenticaÃ§Ã£o**: Login local com senha
- **Criptografia**: AES-256 para dados sensÃ­veis
- **Backup**: Criptografado e versionado
- **Logs**: Auditoria completa de operaÃ§Ãµes

### 8.3 Confiabilidade
- **Disponibilidade**: 99,9% (aplicaÃ§Ã£o local)
- **RecuperaÃ§Ã£o**: RTO < 1 hora
- **Integridade**: ValidaÃ§Ãµes em mÃºltiplas camadas
- **ConsistÃªncia**: TransaÃ§Ãµes ACID no SQLite

### 8.4 Usabilidade
- **Curva de aprendizado**: < 1 semana
- **Interface**: Intuitiva e consistente
- **Feedback**: Visual e sonoro para aÃ§Ãµes
- **Help**: Contextual e integrado

### 8.5 Manutenibilidade
- **CÃ³digo**: Clean Code principles
- **DocumentaÃ§Ã£o**: Inline + externa
- **Testes**: Cobertura > 80%
- **Deploy**: Single executable

---

## ğŸš€ 9. ROADMAP DE IMPLEMENTAÃ‡ÃƒO

### FASE 1: FundaÃ§Ã£o (Semanas 1-3)
- [x] Setup do projeto Electron + React + TypeScript
- [x] CriaÃ§Ã£o do banco SQLite com schema completo
- [x] Estrutura base de navegaÃ§Ã£o
- [x] Sistema de autenticaÃ§Ã£o local
- [x] MÃ³dulo de backup automÃ¡tico

### FASE 2: Core MetrolÃ³gico (Semanas 4-6)
- [ ] CRUD completo de equipamentos
- [ ] GestÃ£o de Fator K para medidores
- [ ] Sistema de validaÃ§Ãµes RM_EQUIP
- [ ] Controle de calibraÃ§Ãµes
- [ ] Upload e gestÃ£o de certificados
- [ ] CÃ¡lculo de incertezas

### FASE 3: EspecializaÃ§Ãµes (Semanas 7-9)
- [ ] GestÃ£o de placas de orifÃ­cio
- [ ] GestÃ£o de trechos retos
- [ ] Controle de vÃ¡lvulas
- [ ] GestÃ£o de poÃ§os (BTP)
- [ ] AnÃ¡lises quÃ­micas (FQ)
- [ ] Cronogramas visuais

### FASE 4: Controles AvanÃ§ados (Semanas 10-12)
- [ ] Sistema de alertas multi-nÃ­vel
- [ ] Controle de movimentaÃ§Ã£o
- [ ] GestÃ£o de sobressalentes
- [ ] NÃ£o conformidades
- [ ] MOC (Management of Change)
- [ ] AnÃ¡lise de causa raiz

### FASE 5: RelatÃ³rios e Dashboard (Semanas 13-14)
- [ ] Dashboard executivo
- [ ] RelatÃ³rio ANP automÃ¡tico
- [ ] RelatÃ³rio ISO 17025
- [ ] ExportaÃ§Ãµes Excel/PDF
- [ ] GrÃ¡ficos e tendÃªncias
- [ ] KPIs operacionais

### FASE 6: Mobile e FinalizaÃ§Ã£o (Semanas 15-16)
- [ ] PWA Mobile (consulta)
- [ ] QR Code scanning
- [ ] OtimizaÃ§Ã£o de performance
- [ ] Testes de aceitaÃ§Ã£o
- [ ] DocumentaÃ§Ã£o completa
- [ ] Treinamento e deploy

---

## ğŸ“‹ 10. CRITÃ‰RIOS DE ACEITAÃ‡ÃƒO

### 10.1 Funcionais
- âœ… Todas as 30+ tabelas implementadas
- âœ… ValidaÃ§Ãµes RM_EQUIP funcionando
- âœ… CÃ¡lculos de incerteza conforme GUM
- âœ… Sistema de alertas operacional
- âœ… RelatÃ³rios ANP/ISO gerados corretamente
- âœ… MOC com workflow completo
- âœ… GestÃ£o de nÃ£o conformidades
- âœ… Mobile PWA funcional

### 10.2 NÃ£o Funcionais
- âœ… Performance < 2s
- âœ… Banco SQLite otimizado
- âœ… Backup automÃ¡tico funcionando
- âœ… Interface responsiva
- âœ… Zero perda de dados

### 10.3 Compliance
- âœ… ISO/IEC 17025:2017 atendida
- âœ… ISO 10012:2004 implementada
- âœ… ANP/Inmetro nÂº 1/2013 conforme
- âœ… Rastreabilidade completa
- âœ… AuditÃ¡vel

---

## ğŸ’¡ 11. CONSIDERAÃ‡Ã•ES TÃ‰CNICAS FINAIS

### 11.1 OtimizaÃ§Ãµes SQLite
```sql
-- ConfiguraÃ§Ãµes recomendadas
PRAGMA journal_mode = WAL;        -- Write-Ahead Logging
PRAGMA synchronous = NORMAL;      -- Balanceamento performance/seguranÃ§a
PRAGMA cache_size = -64000;        -- 64MB cache
PRAGMA temp_store = MEMORY;       -- Temp tables em memÃ³ria
PRAGMA mmap_size = 268435456;     -- Memory-mapped I/O

-- Ãndices crÃ­ticos
CREATE INDEX idx_equip_numero_serie ON equipamentos(numero_serie);
CREATE INDEX idx_equip_tag ON equipamentos(tag_equipamento);
CREATE INDEX idx_calibracao_vencimento ON plano_calibracao(data_proxima_calibracao);
CREATE INDEX idx_poco_teste ON teste_poco(poco_id, data_teste);
```

### 11.2 EstratÃ©gia de Backup
```typescript
interface BackupStrategy {
  automatic: {
    frequency: 'daily';
    time: '02:00';
    retention: 30; // dias
  };
  
  incremental: {
    enabled: true;
    frequency: 'hourly';
  };
  
  location: {
    primary: './database/backups/';
    secondary: 'optional_network_path/';
  };
  
  naming: 'sgm_backup_YYYY-MM-DD_HH-mm.db';
  compression: true;
  encryption: true;
}
```

### 11.3 ValidaÃ§Ãµes CrÃ­ticas
```typescript
// ValidaÃ§Ãµes que DEVEM ser implementadas
const CriticalValidations = {
  // Equipamentos fiscais
  fiscal: {
    certificado_obrigatorio: true,
    incerteza_maxima: 0.3, // %
    frequencia_calibracao: 365, // dias
    rastreabilidade_completa: true
  },
  
  // Testes de poÃ§os
  poco: {
    frequencia_maxima: 90, // dias
    btp_obrigatorio: true,
    validacao_tecnica: true
  },
  
  // AnÃ¡lises quÃ­micas
  quimica: {
    chain_of_custody: true,
    laboratorio_acreditado: true,
    parametros_minimos: ['densidade', 'bsw', 'salinidade']
  }
};
```

---

**Documento elaborado por:** Especialista SÃªnior em Sistemas de GestÃ£o MetrolÃ³gica  
**Data:** 2025  
**VersÃ£o:** 2.0 DEFINITIVA  
**Status:** APROVADO PARA DESENVOLVIMENTO  
**ObservaÃ§Ã£o:** Este PRD consolidado incorpora todas as funcionalidades essenciais para gestÃ£o completa de sistemas de mediÃ§Ã£o de petrÃ³leo e gÃ¡s natural, em total conformidade com as normas ISO/IEC 17025:2017, ISO 10012:2004 e Regulamento ANP/Inmetro nÂº 1/2013.